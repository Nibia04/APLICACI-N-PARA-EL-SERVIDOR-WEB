<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Client - Eventos en Tiempo Real</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .status {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #10b981;
        }

        .status-dot.disconnected {
            background: #ef4444;
            animation: none;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .info-box {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .info-box p {
            margin: 5px 0;
            color: #374151;
        }

        .events-container {
            grid-column: 1 / -1;
        }

        .event-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .event-item {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            animation: slideIn 0.3s ease-out;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-item.evento {
            border-left: 4px solid #f59e0b;
        }

        .event-item.ubicacion {
            border-left: 4px solid #3b82f6;
        }

        .event-item.asiento {
            border-left: 4px solid #8b5cf6;
        }

        .event-item.tipo-entrada {
            border-left: 4px solid #ec4899;
        }

        .event-item.compra {
            border-left: 4px solid #10b981;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .event-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
            color: white;
        }

        .event-type.crear {
            background: #10b981;
        }

        .event-type.actualizar {
            background: #3b82f6;
        }

        .event-type.eliminar {
            background: #ef4444;
        }

        .event-time {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .event-data {
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #1f2937;
            max-height: 200px;
            overflow-y: auto;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }

        .btn-clear {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .btn-clear:hover {
            background: #dc2626;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 6px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ WebSocket Client</h1>
            <p>Eventos en tiempo real desde el REST API</p>
        </div>

        <div class="grid">
            <!-- Informaci√≥n del cliente -->
            <div class="card">
                <h2>üì° Estado de Conexi√≥n</h2>
                <div class="status">
                    <div class="status-dot disconnected" id="statusDot"></div>
                    <span id="statusText">Desconectado</span>
                </div>
                <div class="info-box">
                    <p><strong>ID del Cliente:</strong></p>
                    <p id="clientId" style="font-family: monospace; font-size: 0.9rem;">N/A</p>
                </div>
                <div class="info-box">
                    <p><strong>URL WebSocket:</strong></p>
                    <p style="font-family: monospace; font-size: 0.9rem;">http://localhost:3001</p>
                </div>
                <div class="info-box">
                    <p><strong>Flujo de Datos:</strong></p>
                    <p style="font-size: 0.9rem;">REST API ‚Üí Webhook ‚Üí HTTP ‚Üí WebSocket</p>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="card">
                <h2>üìä Estad√≠sticas</h2>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="eventCount">0</div>
                        <div class="stat-label">Eventos</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="createCount">0</div>
                        <div class="stat-label">Creaciones</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="updateCount">0</div>
                        <div class="stat-label">Actualizaciones</div>
                    </div>
                </div>
                <div class="info-box" style="margin-top: 15px;">
                    <p><strong>√öltima actualizaci√≥n:</strong></p>
                    <p id="lastUpdate" style="font-size: 0.9rem;">N/A</p>
                </div>
            </div>

            <!-- Eventos en tiempo real -->
            <div class="card events-container">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>‚ö° Eventos Recibidos</h2>
                    <button class="btn-clear" onclick="clearEvents()">Limpiar</button>
                </div>
                <div class="event-list" id="eventList">
                    <div class="empty-state">
                        üëÇ Esperando eventos del REST API...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let stats = {
            eventos: 0,
            creaciones: 0,
            actualizaciones: 0,
            eliminaciones: 0,
        };

        // Conectar al WebSocket
        const socket = io('http://localhost:3001', {
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            reconnectionAttempts: 5,
        });

        socket.on('connect', () => {
            console.log('‚úÖ Conectado al WebSocket');
            updateStatus(true);
            document.getElementById('clientId').textContent = socket.id;
        });

        socket.on('disconnect', () => {
            console.log('‚ùå Desconectado del WebSocket');
            updateStatus(false);
        });

        socket.on('connect_error', (error) => {
            console.error('‚ùå Error de conexi√≥n:', error);
            updateStatus(false);
        });

        // Escuchar eventos nuevos
        socket.on('evento:nuevo', (evento) => {
            console.log('üì® Evento recibido:', evento);
            addEventToList(evento);
            updateStats(evento);
        });

        // Escuchar conexiones de clientes
        socket.on('cliente:conectado', (data) => {
            console.log('üë§ Cliente conectado:', data);
        });

        socket.on('cliente:desconectado', (data) => {
            console.log('üë§ Cliente desconectado:', data);
        });

        // Funciones
        function updateStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            if (connected) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Conectado ‚úÖ';
                statusText.style.color = '#10b981';
            } else {
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Desconectado ‚ùå';
                statusText.style.color = '#ef4444';
            }
        }

        function addEventToList(evento) {
            const eventList = document.getElementById('eventList');

            // Si est√° vac√≠o, limpiar
            if (eventList.innerHTML.includes('Esperando eventos')) {
                eventList.innerHTML = '';
            }

            const eventItem = document.createElement('div');
            eventItem.className = `event-item ${evento.tipo}`;

            const timestamp = new Date(evento.timestamp).toLocaleTimeString('es-ES');

            eventItem.innerHTML = `
                <div class="event-header">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span class="event-type ${evento.operacion}">${evento.operacion.toUpperCase()}</span>
                        <span style="font-weight: bold; color: #1f2937;">${evento.tipo}</span>
                    </div>
                    <span class="event-time">${timestamp}</span>
                </div>
                <div class="event-data">${JSON.stringify(evento.datos, null, 2)}</div>
            `;

            eventList.insertBefore(eventItem, eventList.firstChild);

            // Limitar a los √∫ltimos 50 eventos
            while (eventList.children.length > 50) {
                eventList.removeChild(eventList.lastChild);
            }
        }

        function updateStats(evento) {
            stats.eventos++;

            if (evento.operacion === 'crear') {
                stats.creaciones++;
            } else if (evento.operacion === 'actualizar') {
                stats.actualizaciones++;
            } else if (evento.operacion === 'eliminar') {
                stats.eliminaciones++;
            }

            document.getElementById('eventCount').textContent = stats.eventos;
            document.getElementById('createCount').textContent = stats.creaciones;
            document.getElementById('updateCount').textContent = stats.actualizaciones;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('es-ES');
        }

        function clearEvents() {
            const eventList = document.getElementById('eventList');
            eventList.innerHTML = '<div class="empty-state">üëÇ Esperando eventos del REST API...</div>';
            stats = {
                eventos: 0,
                creaciones: 0,
                actualizaciones: 0,
                eliminaciones: 0,
            };
            document.getElementById('eventCount').textContent = '0';
            document.getElementById('createCount').textContent = '0';
            document.getElementById('updateCount').textContent = '0';
            document.getElementById('lastUpdate').textContent = 'N/A';
        }
    </script>
</body>

</html>